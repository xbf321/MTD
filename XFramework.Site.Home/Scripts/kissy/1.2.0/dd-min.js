/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Sep 22 13:54
*/
KISSY.add("dd/ddm",function(k,l,m,g,h){function d(){d.superclass.constructor.apply(this,arguments);this._init()}function a(c){var f=c.offset();return{left:f.left,right:f.left+c.outerWidth(),top:f.top,bottom:f.top+c.outerHeight()}}function b(c,f){return c.left<=f.left&&c.right>=f.left&&c.top<=f.top&&c.bottom>=f.top}function e(c){if(c.top>=c.bottom||c.left>=c.right)return 0;return(c.right-c.left)*(c.bottom-c.top)}function i(c,f){return{left:Math.max(c.left,f.left),right:Math.min(c.right,f.right),top:Math.max(c.top,
f.top),bottom:Math.min(c.bottom,f.bottom)}}var j=document;d.ATTRS={prefixCls:{value:"ks-dd-"},bufferTime:{value:200},activeDrag:{},activeDrop:{},drops:{value:[]}};k.extend(d,h,{_regDrop:function(c){this.get("drops").push(c)},_unregDrop:function(c){c=k.indexOf(c,this.get("drops"));c!=-1&&this.get("drops").splice(c,1)},_init:function(){this._showShimMove=k.throttle(this._move,30,this)},_move:function(c){var f=this.get("activeDrag");if(f){c.preventDefault();f._move(c);this._notifyDropsMove(c)}},_notifyDropsMove:function(c){var f=
this.get("activeDrag"),n=f.get("mode"),s=this.get("drops"),o,u=0,v=a(f.get("node")),p=e(v);k.each(s,function(r){var q=r.getNodeFromTarget(c,f.get("dragNode")[0],f.get("node")[0]);if(q)if(n=="point"){if(b(a(q),f.mousePos))if(!o||o.get("node").contains(q))o=r}else if(n=="intersect"){q=e(i(v,a(q)));if(q>u){u=q;o=r}}else if(n=="strict"){q=e(i(v,a(q)));if(q==p){o=r;return false}}});(s=this.get("activeDrop"))&&s!=o&&s._handleOut(c);if(o)o._handleOver(c);else{f.get("node").removeClass(this.get("prefixCls")+
"drag-over");this.set("activeDrop",null)}},_deactivateDrops:function(){var c=this.get("activeDrag"),f=this.get("activeDrop");c.get("node").removeClass(this.get("prefixCls")+"drag-over");if(f){var n={drag:c,drop:f};f.get("node").removeClass(this.get("prefixCls")+"drop-over");f.fire("drophit",n);c.fire("dragdrophit",n);this.fire("drophit",n);this.fire("dragdrophit",n)}else{c.fire("dragdropmiss",{drag:c});this.fire("dragdropmiss",{drag:c})}},_start:function(c){var f=this,n=f.get("bufferTime")||0;f._registerEvent();
if(n)f._bufferTimer=setTimeout(function(){f._bufferStart(c)},n);else f._bufferStart(c)},_bufferStart:function(c){this.set("activeDrag",c);c.get("shim")&&this._activeShim();c._start();c.get("dragNode").addClass(this.get("prefixCls")+"dragging")},_end:function(c){var f=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});if(f){f._end(c);f.get("dragNode").removeClass(this.get("prefixCls")+
"dragging");this._deactivateDrops(c);this.set("activeDrag",null);this.set("activeDrop",null)}},_activeShim:function(){var c=document;this._shim=(new g("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;cursor:move;z-index:999999;'></div>")).appendTo(c.body);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:l.docHeight()})},_registerEvent:function(){m.on(j,"mouseup",this._end,this);m.on(j,"mousemove",
this._showShimMove,this)},_unregisterEvent:function(){m.remove(j,"mousemove",this._showShimMove,this);m.remove(j,"mouseup",this._end,this)}});h=new d;h.inRegion=b;h.region=a;return h},{requires:["dom","event","node","base"]});
KISSY.add("dd/draggable",function(k,l,m,g,h){function d(){d.superclass.constructor.apply(this,arguments);this._init()}d.POINT="point";d.INTERSECT="intersect";d.STRICT="strict";d.ATTRS={node:{setter:function(a){return m.one(a)}},dragNode:{},shim:{value:true},handlers:{value:[]},cursor:{value:"move"},mode:{value:"point"}};k.extend(d,g,{_init:function(){var a=this.get("node"),b=this.get("handlers");this.set("dragNode",a);if(b.length===0)b[0]=a;for(var e=0;e<b.length;e++){var i=b[e];i=m.one(i);i.unselectable();
this.get("cursor")&&i.css("cursor",this.get("cursor"))}a.on("mousedown",this._handleMouseDown,this)},destroy:function(){for(var a=this.get("dragNode"),b=this.get("handlers"),e=0;e<b.length;e++){var i=b[e];i.css("cursor")==this.get("cursor")&&i.css("cursor","auto")}a.detach("mousedown",this._handleMouseDown,this);this.detach()},_check:function(a){for(var b=this.get("handlers"),e=0;e<b.length;e++){var i=b[e];if(i.contains(a)||i[0]==a[0])return true}return false},_handleMouseDown:function(a){if(this._check(new m(a.target))){a.preventDefault();
this._prepare(a)}},_prepare:function(a){h._start(this);var b=this.get("node"),e=a.pageX;a=a.pageY;b=b.offset();this.startMousePos=this.mousePos={left:e,top:a};this.startNodePos=b;this._diff={left:e-b.left,top:a-b.top};this.set("diff",this._diff)},_move:function(a){var b=this.get("diff"),e=a.pageX-b.left;b=a.pageY-b.top;this.mousePos={left:a.pageX,top:a.pageY};a={left:e,top:b,pageX:a.pageX,pageY:a.pageY,drag:this};this.fire("drag",a);h.fire("drag",a)},_end:function(){this.fire("dragend",{drag:this});
h.fire("dragend",{drag:this})},_start:function(){this.fire("dragstart",{drag:this});h.fire("dragstart",{drag:this})}});return d},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable",function(k,l,m,g){function h(){h.superclass.constructor.apply(this,arguments);this._init()}h.ATTRS={node:{setter:function(d){if(d){d=l.one(d);d.addClass(g.get("prefixCls")+"drop");return d}}}};k.extend(h,m,{getNodeFromTarget:function(d,a,b){d=this.get("node");var e=d[0];return e==a||e==b?null:d},_init:function(){g._regDrop(this)},_handleOut:function(){var d=g.get("activeDrag");this.get("node").removeClass(g.get("prefixCls")+"drop-over");var a={drop:this,drag:d};this.fire("dropexit",
a);g.fire("dropexit",a);d.get("node").removeClass(g.get("prefixCls")+"drag-over");d.fire("dragexit",a);g.fire("dragexit",a)},_handleOver:function(d){var a=g.get("activeDrop");g.set("activeDrop",this);var b=g.get("activeDrag");this.get("node").addClass(g.get("prefixCls")+"drop-over");d=k.mix({drag:b,drop:this},d);if(this!=a){b.get("node").addClass(g.get("prefixCls")+"drag-over");b.fire("dragenter",d);this.fire("dropenter",d);g.fire("dragenter",d);g.fire("dropenter",d)}else{b.fire("dragover",d);this.fire("dropover",
d);g.fire("dragover",d);g.fire("dropover",d)}},destroy:function(){g._unregDrop(this)}});return h},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(k,l){function m(){m.superclass.constructor.apply(this,arguments);this[g]={}}var g="__proxy_destructors",h="__proxy";m.ATTRS={node:{value:function(d){return new l(d.get("node").clone(true))}},destroyOnEnd:{value:false}};k.extend(m,k.Base,{attach:function(d){function a(){var j=e.get("node"),c=d.get("node");if(!e[h]&&k.isFunction(j)){j=j(d);j.addClass("ks-dd-proxy");j.css("position","absolute");e[h]=j}c.parent().append(e[h]);e[h].show();e[h].offset(c.offset());d.set("dragNode",
c);d.set("node",e[h])}function b(){var j=e[h];d.get("dragNode").offset(j.offset());j.hide();if(e.get("destroyOnEnd")){j.remove();e[h]=null}d.set("node",d.get("dragNode"))}if(!d.__proxy_id){var e=this;d.on("dragstart",a);d.on("dragend",b);var i=d.__proxy_id=k.guid("dd-proxyid-");e[g][i]={drag:d,fn:function(){d.detach("dragstart",a);d.detach("dragend",b)}}}},unAttach:function(d){var a=d.__proxy_id;if(a){this[g][a].fn();delete this[g][a];delete d.__proxy_id}},destroy:function(){var d=this.get("node");
d&&!k.isFunction(d)&&d.remove();for(var a in this[g])this.unAttach(this[g][a].drag)}});return m},{requires:["node"]});
KISSY.add("dd/draggable-delegate",function(k,l,m,g,h){function d(){d.superclass.constructor.apply(this,arguments)}k.extend(d,m,{_init:function(){var a=this.get("handlers"),b=this.get("container");a.length===0&&a.push(this.get("selector"));b.on("mousedown",this._handleMouseDown,this)},_getHandler:function(a){for(var b=this.get("container"),e=this.get("handlers");a&&a[0]!==b[0];){for(var i=0;i<e.length;i++)if(g.test(a[0],e[i],b[0]))return a;a=a.parent()}},_getNode:function(a){for(var b=this.get("container"),
e=this.get("selector");a&&a[0]!=b[0];){if(g.test(a[0],e,b[0]))return a;a=a.parent()}},_handleMouseDown:function(a){var b=new h(a.target);if(b=b&&this._getHandler(b))if(b=this._getNode(b)){a.preventDefault();this.set("node",b);this.set("dragNode",b);this._prepare(a)}},destroy:function(){this.get("container").detach("mousedown",this._handleMouseDown,this);this.detach()}},{ATTRS:{container:{setter:function(a){return h.one(a)}},selector:{}}});return d},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/droppable-delegate",function(k,l,m,g,h){function d(){d.superclass.constructor.apply(this,arguments)}k.extend(d,m,{getNodeFromTarget:function(a,b,e){a={left:a.pageX,top:a.pageY};var i=this.get("container"),j=this.get("selector");i=i.all(j);for(j=0;j<i.length;j++){var c=i[j],f=new h(c);if(!(c==e||c==b))if(l.inRegion(l.region(f),a)){this.set("lastNode",this.get("node"));this.set("node",f);return f}}return null},_handleOut:function(){d.superclass._handleOut.call(this);this.set("node",null);
this.set("lastNode",null)},_handleOver:function(a){var b=l.get("activeDrop");l.set("activeDrop",this);var e=l.get("activeDrag");this.get("node").addClass(l.get("prefixCls")+"drop-over");a=k.mix({drag:e,drop:this},a);var i=this.get("node"),j=this.get("lastNode");if(this!=b||!j||j&&j[0]!==i[0]){if(j){this.set("node",j);d.superclass._handleOut.call(this)}this.set("node",i);e.get("node").addClass(l.get("prefixCls")+"drag-over");e.fire("dragenter",a);this.fire("dropenter",a);l.fire("dragenter",a);l.fire("dropenter",
a)}else{e.fire("dragover",a);this.fire("dropover",a);l.fire("dragover",a);l.fire("dropover",a)}}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return h.one(a)}}}});return d},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/scroll",function(k,l,m,g){function h(){h.superclass.constructor.apply(this,arguments);this[a]={}}var d=100,a="__dd_scrolls";h.ATTRS={node:{setter:function(b){return m.one(b)}},rate:{value:[10,10]},diff:{value:[20,20]}};k.extend(h,l,{getRegion:function(b){return!b||b==window?{width:g.viewportWidth(),height:g.viewportHeight()}:{width:b.outerWidth(),height:b.outerHeight()}},getOffset:function(b){return!b||b==window?{left:g.scrollLeft(),top:g.scrollTop()}:b.offset()},getScroll:function(b){return!b||
b==window?{left:g.scrollLeft(),top:g.scrollTop()}:{left:b[0].scrollLeft,top:b[0].scrollTop}},setScroll:function(b,e){if(!b||b==window)window.scrollTo(e.left,e.top);else{b[0].scrollLeft=e.left;b[0].scrollTop=e.top}},unAttach:function(b){var e=b["__dd-scroll-id-"];if(e){this[a][e].fn();delete b["__dd-scroll-id-"];delete this[a][e]}},destroy:function(){for(var b in this[a])this.unAttach(this[a][b].drag)},attach:function(b){function e(p){if(!p.fake){var r=c.get("node");s=p;o=k.clone(b.mousePos);p=c.getOffset(r);
o.left-=p.left;o.top-=p.top;u||j()}}function i(){clearTimeout(u);u=null}function j(){var p=c.get("node"),r=c.getRegion(p),q=r.width;r=r.height;var t=c.getScroll(p),x=k.clone(t),w=false;if(o.top-r>=-n[1]){t.top+=f[1];w=true}if(o.top<=n[1]){t.top-=f[1];w=true}if(o.left-q>=-n[0]){t.left+=f[0];w=true}if(o.left<=n[0]){t.left-=f[0];w=true}if(w){c.setScroll(p,t);u=setTimeout(arguments.callee,d);s.fake=true;if(!p||p==window){t=c.getScroll(p);s.left+=t.left-x.left;s.top+=t.top-x.top}b.fire("drag",s)}else u=
null}if(!b["__dd-scroll-id-"]){var c=this,f=c.get("rate"),n=c.get("diff"),s,o,u=null;b.on("drag",e);b.on("dragend",i);var v=b["__dd-scroll-id-"]=k.guid("__dd-scroll-id-");c[a][v]={drag:b,fn:function(){b.detach("drag",e);b.detach("dragend",i)}}}}});return h},{requires:["base","node","dom"]});
KISSY.add("dd",function(k,l,m,g,h,d,a,b){l={Draggable:m,Droppable:g,DDM:l,Proxy:h,DraggableDelegate:d,DroppableDelegate:a,Scroll:b};k.mix(k,l);return l},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
